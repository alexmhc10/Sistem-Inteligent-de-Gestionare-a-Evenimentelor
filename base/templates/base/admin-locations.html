{% extends 'main.html' %}
{% block navbar %}
{% endblock %}

{% block content %}

<div class="container-fluid">
    <div class="row flex-nowrap">
        <div class="col-auto siderbar col-md-2 forevents px-sm-1 px-0" style="flex: 0 0 12.5%; max-width: 12.5%;">
            <div class="d-flex flex-column align-items-center align-items-sm-start px-3 pt-2 text-white min-vh-100">
                <a href="{% url 'home-admin' %}"
                    class="d-flex align-items-center pb-3 mb-md-0 me-md-auto text-white text-decoration-none">
                    <img class="navbar-brand" style="width:100%" src="{{ MEDIA_URL }}logos/logo.jpg"
                        alt="EventEase Logo">
                </a>
                <ul class="nav nav-pills flex-column text-white mb-sm-auto mb-0 align-items-center align-items-sm-start"
                    id="menu">
                    <li class="nav-item">
                        <a href="{% url 'home-admin' %}" class="nav-link align-middle px-0 text-white">
                            <i class="fs-4 bi-house"></i>
                            <span class="ms-1 d-none d-sm-inline">Home</span>
                        </a>
                    </li>

                    <li>
                        <a href="{% url 'users' %}" class="nav-link px-0 align-middle text-white">
                            <i class="fs-4 bi-people"></i>
                            <span class="ms-1 d-none d-sm-inline">Users</span>
                        </a>
                    </li>

                    <li>
                        <a href="{% url 'admin-events' %}" class="nav-link px-0 align-middle text-white">
                            <i class="fs-4 bi-calendar-event"></i>
                            <span class="ms-1 d-none d-sm-inline">Events</span>
                        </a>
                    </li>
                   

                    <li>
                        <a href="{% url 'admin-locations' %}" class="nav-link px-0 align-middle text-white">
                            <i class="fs-4 bi-geo-alt"></i>
                            <span class="ms-1 d-none d-sm-inline">Locations</span>
                        </a>
                    </li>
                </ul>

                <hr>
                <div class="dropdown pb-4">
                    <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle"
                        id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="{{ request.user.profile_set.first.photo.url }}" alt="hugenerd" width="30" height="30"
                            class="rounded-circle">
                        <span class="d-none d-sm-inline mx-1">{{ request.user.username }}</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-light text-small shadow">
                        <li><a class="dropdown-item" href="{% url 'admin_account_settings' %}">Settings</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="{% url 'logout' %}">Sign out</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col py-3 events">
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box d-sm-flex align-items-center justify-content-between bg-galaxy-transparent">
                        <h4 class="mb-sm-0">Locations</h4>

                        <div class="page-title-right">
                            <ol class="breadcrumb m-0">
                                <li class="breadcrumb-item"><a href="javascript: void(0);">EventEase</a></li>
                                <li class="breadcrumb-item active">Locations</li>
                            </ol>
                        </div>

                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xl-3 col-lg-4">
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex mb-3">
                                <div class="flex-grow-1">
                                    <h5 class="fs-16">Filters</h5>
                                </div>
                                <div class="flex-shrink-0">
                                    <a href="{% url 'admin-locations' %}" class="text-decoration-underline" id="clearall">Clear All</a>
                                </div>
                            </div>
                        </div>

                        <div class="accordion accordion-flush filter-accordion">

                            <div class="card-body border-bottom">
                                <div>
                                    <p class="text-muted text-uppercase fs-12 fw-medium mb-2">Event Types</p>
                                    <ul class="list-unstyled mb-0 filter-list">
                                        <a href="#" class="d-flex py-1 align-items-center">
                                            <div class="flex-grow-1">
                                                <h5 class="fs-13 mb-0 listname">All</h5>
                                            </div>
                                            <div class="flex-shrink-0 ms-2">
                                                <span class="badge bg-light text-muted">{{ all_locations_count }}</span>
                                            </div>
                                        </a>
                                        {% for item in types_with_location_count %}
                                        <li>
                                            <a href="#" class="d-flex py-1 align-items-center">
                                                <div class="flex-grow-1">
                                                    <h5 class="fs-13 mb-0 listname">{{ item.type }}</h5>
                                                </div>
                                                <div class="flex-shrink-0 ms-2">
                                                    <span class="badge bg-light text-muted">{{ item.count }}</span>
                                                </div>
                                            </a>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>

                            <div class="card-body border-bottom">
                                <p class="text-muted text-uppercase fs-12 fw-medium mb-4">Price</p>
                            
                                <div id="location-price-range" class="noUi-target noUi-ltr noUi-horizontal noUi-txt-dir-ltr mt-5">
                                    
                                    <div class="noUi-base">
                                        <div class="noUi-connects">
                                            <div class="noUi-connect noUi-draggable" style="transform: translate(0%, 0px) scale(1, 1);"></div>
                                        </div>
                                        <div class="noUi-origin" style="transform: translate(-100%, 0px); z-index: 5;">
                                            <div class="noUi-handle noUi-handle-lower" data-handle="0" tabindex="0" role="slider" 
                                                 aria-orientation="horizontal" aria-valuemin="0.0" aria-valuemax="1980.0" 
                                                 aria-valuenow="0.0" >
                                                <div class="noUi-touch-area"></div>
                                            </div>
                                        </div>
                                        <div class="noUi-origin" style="transform: translate(0%, 0px); z-index: 4;">
                                            <div class="noUi-handle noUi-handle-upper" data-handle="1" tabindex="0" role="slider" 
                                                 aria-orientation="horizontal" aria-valuemin="20.0" aria-valuemax="2000.0" 
                                                 aria-valuenow="2000.0" >
                                                <div class="noUi-touch-area"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            
                                <div class="formCost d-flex gap-2 align-items-center mt-3">
                                    <input class="form-control form-control-sm" type="text" id="minCost" value="0">
                                    <span class="fw-semibold text-muted">to</span>
                                    <input class="form-control form-control-sm" type="text" id="maxCost" value="3500">
                                </div>
                            </div>
                            
                          
                            

                            <div class="accordion-item">
                                <h2 class="accordion-header" id="flush-headingBrands">
                                    <button class="accordion-button bg-transparent shadow-none" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#flush-collapseBrands"
                                        aria-expanded="true" aria-controls="flush-collapseBrands">
                                        <span class="text-muted text-uppercase fs-12 fw-medium">Organizers</span> 
                                        <span class="badge bg-success rounded-pill align-middle ms-1 filter-badge"> {{count_organizers}} </span>
                                    </button>
                                </h2>

                                <div id="flush-collapseBrands" class="accordion-collapse collapse show"
                                    aria-labelledby="flush-headingBrands">
                                    <div class="accordion-body text-body pt-0">
                                        <div class="search-box search-box-sm">
                                            <input type="text" class=" form-control bg-light border-0"
                                                id="searchOrganizersList" placeholder="Search Organizers...">
                                            <i class="ri-search-line search-icon"></i>
                                        </div>
                                        <div class="d-flex flex-column gap-2 mt-3 org-filter-check">
                                            {% for organizer in organizers %}
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="Boat"
                                                    id="locationBrandRadio5" checked="">
                                                <label class="form-check-label" for="locationBrandRadio5"> {{ organizer.username }} </label>
                                            </div>
                                            {% endfor %}

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- end accordion-item -->
                            <!-- 
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="flush-headingDiscount">
                                    <button class="accordion-button bg-transparent shadow-none" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseDiscount" aria-expanded="true" aria-controls="flush-collapseDiscount">
                                        <span class="text-muted text-uppercase fs-12 fw-medium">Discount</span> <span class="badge bg-success rounded-pill align-middle ms-1 filter-badge" style="display: none;">0</span>
                                    </button>
                                </h2>
                                <div id="flush-collapseDiscount" class="accordion-collapse collapse show" aria-labelledby="flush-headingDiscount" style="">
                                    <div class="accordion-body text-body pt-1">
                                        <div class="d-flex flex-column gap-2 filter-check">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="50% or more" id="locationdiscountRadio6">
                                                <label class="form-check-label" for="locationdiscountRadio6">50% or more</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="40% or more" id="locationdiscountRadio5">
                                                <label class="form-check-label" for="locationdiscountRadio5">40% or more</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="30% or more" id="locationdiscountRadio4">
                                                <label class="form-check-label" for="locationdiscountRadio4">
                                                    30% or more
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="20% or more" id="locationdiscountRadio3" checked="">
                                                <label class="form-check-label" for="locationdiscountRadio3">
                                                    20% or more
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="10% or more" id="locationdiscountRadio2">
                                                <label class="form-check-label" for="locationdiscountRadio2">
                                                    10% or more
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="Less than 10%" id="locationdiscountRadio1">
                                                <label class="form-check-label" for="locationdiscountRadio1">
                                                    Less than 10%
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            end accordion-item -->

                            <div class="accordion-item">
                                <h2 class="accordion-header" id="flush-headingRating">
                                    <button class="accordion-button bg-transparent shadow-none" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#flush-collapseRating"
                                        aria-expanded="true" aria-controls="flush-collapseRating">
                                        <span class="text-muted text-uppercase fs-12 fw-medium">Rating</span> <span
                                            class="badge bg-success rounded-pill align-middle ms-1 filter-badge"
                                            style="display: none;">0</span>
                                    </button>
                                </h2>

                                <div id="flush-collapseRating" class="accordion-collapse collapse show"
                                    aria-labelledby="flush-headingRating" >
                                    <div class="accordion-body text-body">
                                        <div class="d-flex flex-column gap-2 star-filter-check">
                                         
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox"
                                                    value="5" id="locationratingRadio4" checked="">
                                                <label class="form-check-label" for="locationratingRadio4">
                                                    <span class="text-muted">
                                                        <span class="star filled">★</span>
                                                        <span class="star filled">★</span>
                                                        <span class="star filled">★</span>
                                                        <span class="star filled">★</span>
                                                        <span class="star filled">★</span>
                                                    </span> 5 stars
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox"
                                                    value="4" id="locationratingRadio4" checked="">
                                                <label class="form-check-label" for="locationratingRadio4">
                                                    <span class="text-muted">
                                                        <span class="star filled">★</span>
                                                        <span class="star filled">★</span>
                                                        <span class="star filled">★</span>
                                                        <span class="star filled">★</span>
                                                        <span class="star empty">★</span>
                                                    </span> 4 &amp; Above
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox"
                                                    value="3" id="locationratingRadio3">
                                                <label class="form-check-label" for="locationratingRadio3">
                                                    <span class="text-muted">
                                                        <span class="star filled">★</span>
                                                        <span class="star filled">★</span>
                                                        <span class="star filled">★</span>
                                                        <span class="star empty">★</span>
                                                        <span class="star empty">★</span>
                                                    </span> 3 &amp; Above
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox"
                                                    value="2" id="locationratingRadio2">
                                                <label class="form-check-label" for="locationratingRadio2">
                                                    <span class="text-muted">
                                                        <span class="star filled">★</span>
                                                        <span class="star filled">★</span>
                                                        <span class="star empty">★</span>
                                                        <span class="star empty">★</span>
                                                        <span class="star empty">★</span>
                                                    </span> 2 &amp; Above
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="1"
                                                    id="locationratingRadio1">
                                                <label class="form-check-label" for="locationratingRadio1">
                                                    <span class="text-muted">
                                                        <span class="star filled">★</span>
                                                        <span class="star empty">★</span>
                                                        <span class="star empty">★</span>
                                                        <span class="star empty">★</span>
                                                        <span class="star empty">★</span>
                                                    </span> 1 star
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="0"
                                                    id="locationratingRadio1">
                                                <label class="form-check-label" for="locationratingRadio1">
                                                    <span class="text-muted">
                                                        <span class="star empty">★</span>
                                                        <span class="star empty">★</span>
                                                        <span class="star empty">★</span>
                                                        <span class="star empty">★</span>
                                                        <span class="star empty">★</span>
                                                    </span> 0 stars
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-9 col-lg-8">
                    <div>
                        <div class="card">
                            <div class="card-header border-0">
                                <div class="row g-4">
                                    <div class="col-sm">
                                        <div class="d-flex justify-content-sm-end">
                                            <div class="search-box ms-2">
                                                <input type="text" class="form-control" id="searchlocationList"
                                                    placeholder="Search Locations...">
                                                <i class="ri-search-line search-icon"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card-header">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <ul class="nav nav-tabs-custom card-header-tabs border-bottom-0" role="tablist">
                                            <li class="nav-item" role="presentation">
                                                <a class="nav-link active fw-semibold" data-bs-toggle="tab"
                                                    href="#locationnav-all" role="tab" aria-selected="true">
                                                    All <span
                                                        class="badge bg-danger-subtle text-danger align-middle rounded-pill ms-1"> {{ all_locations_count }} </span>
                                                </a>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <a class="nav-link fw-semibold" data-bs-toggle="tab"
                                                    href="#locationnav-published" role="tab" aria-selected="false"
                                                    tabindex="-1">
                                                    New <span
                                                        class="badge bg-danger-subtle text-danger align-middle rounded-pill ms-1">{{ new_locations_count }}</span>
                                                </a>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <a class="nav-link fw-semibold" data-bs-toggle="tab"
                                                    href="#locationnav-draft" role="tab" aria-selected="false"
                                                    tabindex="-1">
                                                    Draft
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                  
                                </div>
                            </div>
                            <div class="card-body">

                                <div class="tab-content text-muted">
                                    <div class="tab-pane active" id="locationnav-all" role="tabpanel">
                                        <div id="table-location-list-all" class="table-card gridjs-border-none">
                                           <div role="complementary" class="gridjs gridjs-container"
                                              style="width: 100%;">
                                              <div class="gridjs-wrapper" style="height: auto;">
                                                 <table role="grid" class="gridjs-table" style="height: auto;">
                                                    <thead class="gridjs-thead">
                                                       <tr>
                                                          <th data-column-id="#"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 40px;">
                                                             <div class="gridjs-th-content">#</div>
                                                          </th>
                                                          <th data-column-id="event"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 360px;">
                                                             <div class="gridjs-th-content">Location</div>
                                                          </th>
                                                          <th data-column-id=""
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 200px;">
                                                             <div class="gridjs-th-content">Added by</div>
                                                          </th>
                                                          <th data-column-id="guests"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width:120px;">
                                                             <div class="gridjs-th-content">Max Guests</div>
                                                          </th>
                                                          <th data-column-id="price"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 101px;">
                                                             <div class="gridjs-th-content">Price</div>
                                                          </th>
                                                          <th data-column-id="location"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width:184px;">
                                                             <div class="gridjs-th-content">Location</div>
                                                          </th>
                                                          <th data-column-id="rating"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 105px;">
                                                             <div class="gridjs-th-content">Rating</div>
                                                          </th>
                                                          <th data-column-id="action"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 80px;">
                                                             <div class="gridjs-th-content">Action</div>
                                                          </th>
                                                       </tr>
                                                    </thead>
                                                    {% for item in detailed_locations %}
                                                    <tbody class="gridjs-tbody">
                                                       <tr class="gridjs-tr" data-types="{% for t in item.types.all %}{{ t.name|lower }}{% if not forloop.last %},{% endif %}{% endfor %}">
                                                          <td data-column-id="#" class="gridjs-td">
                                                             <span>
                                                                <div class="form-check checkbox-location-list">
                                                                   <input class="form-check-input"
                                                                      type="checkbox" value="1"
                                                                      id="checkbox-1">
                                                                   <label class="form-check-label"
                                                                      for="checkbox-1"></label>
                                                                </div>
                                                             </span>
                                                          </td>
                                                          <td data-column-id="location" class="gridjs-td">
                                                             <span>
                                                                <div class="d-flex align-items-center">
                                                                   <div class="flex-shrink-0 me-3">
                                                                      <div
                                                                         class="avatar-sm bg-light rounded p-1">
                                                                         <img src="{{ item.photo.url }}"
                                                                            alt=""
                                                                            class="img-fluid d-block"
                                                                            style="height: 50px;width:80px; object-fit: cover;">
                                                                      </div>
                                                                   </div>
                                                                   <div class="flex-grow-1">
                                                                      <h5 class="fs-14 mb-1">
                                                                         <a href="{% url 'admin-view-location' item.name %}"
                                                                            class="text-body">{{ item.name }}</a>
                                                                      </h5>
                                                                      <p class="text-muted mb-0">Category :
                                                                         <span class="fw-medium">
                                                                         {% if item.seats >= 300 %}
                                                                         Big Location
                                                                         {% elif item.seats >= 100 %}
                                                                         Medium Location
                                                                         {% else %}
                                                                         Small Location
                                                                         {% endif %}
                                                                         </span>
                                                                      </p>
                                                                   </div>
                                                                </div>
                                                             </span>
                                                          </td>
                                                          <td data-column-id="organized_by" class="gridjs-td"> {{ item.added_by }} </td>
                                                          <td data-column-id="stock" class="gridjs-td"> {{ item.seats }} </td>
                                                          <td data-column-id="price" class="gridjs-td">
                                                             <span> {{ item.cost }}$ </span>
                                                          </td>
                                                          <td data-column-id="organizer" class="gridjs-td"> {{ item.located }} </td>
                                                          <td data-column-id="rating" class="gridjs-td">
                                                             <span>
                                                             <span
                                                                class="badge bg-light text-body fs-12 fw-medium">
                                                             <span class="star filled">★</span>
                                                             {% for rating in average_ratings %}
                                                             {% if rating.name == item.name %}
                                                             {{ rating.rating }}
                                                             {% endif %}
                                                             {% endfor %}
                                                             </span>
                                                             </span>
                                                          </td>
                                                          <td data-column-id="action" class="gridjs-td" >
                                                             <span>
                                                                <div class="dropdown">
                                                                   <button
                                                                      class="btn btn-soft-secondary btn-sm dropdown"
                                                                      type="button" data-bs-toggle="dropdown"
                                                                      aria-expanded="false">
                                                                   <i class="bi bi-three-dots"></i>
                                                                   </button>
                                                                   <ul class="dropdown-menu dropdown-menu-end" ">
                                                                      <li>
                                                                         <a class="dropdown-item"
                                                                            href="{% url 'admin-view-location' item.name %}">
                                                                         <i
                                                                            class="bi bi-eye align-bottom me-2 text-muted"></i>
                                                                         View </a>
                                                                      </li>
                                                                      <li>
                                                                         <a class="dropdown-item edit-list"
                                                                            data-edit-id="1"
                                                                            href="{% url 'admin_edit_location' item.id %}">
                                                                         <i
                                                                            class="bi bi-pencil-fill align-bottom me-2 text-muted"></i>
                                                                         Edit </a>
                                                                      </li>
                                                                      <hr>
                                                                      <li>
                                                                         <button type="button" class="btn btn-white btn-sm dropdown-item remove-list"
                                  data-bs-toggle="modal"
                                   data-bs-target="#DeleteLocationModal"
                                    data-id ="{{item.id}}">
                                    <i class="bi bi-trash me-1"></i> Delete
                                 </button>
                                                                      </li>
                                                                   </ul>
                                                                </div>
                                                             </span>
                                                          </td>
                                                       </tr>
                                                    </tbody>
                                                    {% endfor %}
                                                 </table>
                                                 <div class="py-4 text-center no-result-message"style="display: none;">
                                                    <div style="width:1185px;"></div>
                                                    <h5 class="mt-4">Sorry! No Result Found</h5>
                                                 </div>
                                              </div>
                                              <div class="gridjs-footer" id="footer-1">
                                                 <div class="gridjs-pagination">
                                                    <div role="status" aria-live="polite" class="gridjs-summary"
                                                       title="Page 1 of 1">
                                                    </div>
                                                    <div class="gridjs-pages">
                                                    </div>
                                                 </div>
                                              </div>
                                              <div id="gridjs-temp" class="gridjs-temp"></div>
                                           </div>
                                        </div>
                                     </div>
                                     <div class="tab-pane" id="locationnav-published" role="tabpanel">
                                        <div id="table-location-list-published" class="table-card gridjs-border-none">
                                           <div role="complementary" class="gridjs gridjs-container"
                                              style="width: 100%;">
                                              <div class="gridjs-wrapper" style="height: auto;">
                                                 <table role="grid" class="gridjs-table" style="height: auto;">
                                                    <thead class="gridjs-thead">
                                                       <tr class="" >
                                                          <th data-column-id="#"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 40px;">
                                                             <div class="gridjs-th-content">#</div>
                                                          </th>
                                                          <th data-column-id="event"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 360px;">
                                                             <div class="gridjs-th-content">Location</div>
                                                          </th>
                                                          <th data-column-id=""
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 200px;">
                                                             <div class="gridjs-th-content">Added by</div>
                                                          </th>
                                                          <th data-column-id="guests"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width:120px;">
                                                             <div class="gridjs-th-content">Max Guests</div>
                                                          </th>
                                                          <th data-column-id="price"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 101px;">
                                                             <div class="gridjs-th-content">Price</div>
                                                          </th>
                                                          <th data-column-id="location"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width:184px;">
                                                             <div class="gridjs-th-content">Location</div>
                                                          </th>
                                                          <th data-column-id="rating"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 105px;">
                                                             <div class="gridjs-th-content">Rating</div>
                                                          </th>
                                                          <th data-column-id="action"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 80px;">
                                                             <div class="gridjs-th-content">Action</div>
                                                          </th>
                                                       </tr>
                                                    </thead>
                                                    <tbody class="gridjs-tbody">
                                                       {% for item in new_locations_detailed %}
                                                    <tbody class="gridjs-tbody">
                                                       <tr class="gridjs-tr" data-types="{% for t in item.types.all %}{{ t.name|lower }}{% if not forloop.last %},{% endif %}{% endfor %}">
                                                          <td data-column-id="#" class="gridjs-td">
                                                             <span>
                                                                <div class="form-check checkbox-location-list">
                                                                   <input class="form-check-input"
                                                                      type="checkbox" value="1"
                                                                      id="checkbox-1">
                                                                   <label class="form-check-label"
                                                                      for="checkbox-1"></label>
                                                                </div>
                                                             </span>
                                                          </td>
                                                          <td data-column-id="location" class="gridjs-td">
                                                             <span>
                                                                <div class="d-flex align-items-center">
                                                                   <div class="flex-shrink-0 me-3">
                                                                      <div
                                                                         class="avatar-sm bg-light rounded p-1">
                                                                         <img src="{{ item.photo.url }}"
                                                                            alt=""
                                                                            class="img-fluid d-block"
                                                                            style="height: 50px;width:80px; object-fit: cover;">
                                                                      </div>
                                                                   </div>
                                                                   <div class="flex-grow-1">
                                                                      <h5 class="fs-14 mb-1">
                                                                         <a href="apps-ecommerce-location-details.html"
                                                                            class="text-body">{{ item.name }}</a>
                                                                      </h5>
                                                                      <p class="text-muted mb-0">Category :
                                                                         <span class="fw-medium">
                                                                         {% if item.seats >= 300 %}
                                                                         Big Location
                                                                         {% elif item.seats >= 100 %}
                                                                         Medium Location
                                                                         {% else %}
                                                                         Small Location
                                                                         {% endif %}
                                                                         </span>
                                                                      </p>
                                                                   </div>
                                                                </div>
                                                             </span>
                                                          </td>
                                                          <td data-column-id="organized_by" class="gridjs-td"> {{ item.added_by }} </td>
                                                          <td data-column-id="stock" class="gridjs-td"> {{ item.seats }} </td>
                                                          <td data-column-id="price" class="gridjs-td">
                                                             <span>{{ item.cost }}$</span>
                                                          </td>
                                                          <td data-column-id="organizer" class="gridjs-td"> {{ item.located }} </td>
                                                          <td data-column-id="rating" class="gridjs-td">
                                                             <span>
                                                             <span
                                                                class="badge bg-light text-body fs-12 fw-medium">
                                                             <span class="star filled">★</span>
                                                             {% for rating in average_ratings %}
                                                             {% if rating.name == item.name %}
                                                             {{ rating.rating }}
                                                             {% endif %}
                                                             {% endfor %}
                                                             </span>
                                                             </span>
                                                          </td>
                                                          <td data-column-id="action" class="gridjs-td">
                                                             <span>
                                                                <div class="dropdown">
                                                                   <button
                                                                      class="btn btn-soft-secondary btn-sm dropdown"
                                                                      type="button" data-bs-toggle="dropdown"
                                                                      aria-expanded="false">
                                                                   <i class="bi bi-three-dots"></i>
                                                                   </button>
                                                                   <ul class="dropdown-menu dropdown-menu-end">
                                                                      <li>
                                                                         <a class="dropdown-item"
                                                                            href="apps-ecommerce-location-details.html">
                                                                         <i
                                                                            class="bi bi-eye align-bottom me-2 text-muted"></i>
                                                                         View </a>
                                                                      </li>
                                                                      <li>
                                                                         <a class="dropdown-item edit-list"
                                                                            data-edit-id="1"
                                                                            href="apps-ecommerce-add-location.html">
                                                                         <i
                                                                            class="bi bi-pencil-fill align-bottom me-2 text-muted"></i>
                                                                         Edit </a>
                                                                      </li>
                                                                      <hr>
                                                                      <li>
                                                                         
                                                                         <button type="button" class="btn btn-white btn-sm dropdown-item remove-list"
                                  data-bs-toggle="modal"
                                   data-bs-target="#DeleteLocationModal"
                                    data-id ="{{item.id}}">
                                    <i class="bi bi-trash me-1"></i> Delete
                                 </button>
                                                                      </li>
                                                                   </ul>
                                                                </div>
                                                             </span>
                                                          </td>
                                                       </tr>
                                                    </tbody>
                                                    {% endfor %}
                                                    </tbody>
                                                 </table>
                                                 <div class="py-4 text-center no-result-message" id="no-result-message" style="display: none;">
                                                    <div style="width:1185px;"></div>
                                                    <h5 class="mt-4">Sorry! No Result Found</h5>
                                                 </div>
                                              </div>
                                              <div class="gridjs-footer" id="footer-2">
                                                <div class="gridjs-pagination">
                                                    <div role="status" aria-live="polite" class="gridjs-summary"
                                                       title="Page 1 of 1">
                                                    </div>
                                                    <div class="gridjs-pages">
                                                    </div>
                                                 </div>
                                              </div>
                                              <div id="gridjs-temp" class="gridjs-temp"></div>
                                           </div>
                                        </div>
                                     </div>
                                     <div class="tab-pane" id="locationnav-draft" role="tabpanel">
                                        <div id="table-location-list-published" class="table-card gridjs-border-none">
                                           <div role="complementary" class="gridjs gridjs-container"
                                              style="width: 100%;">
                                              <div class="gridjs-wrapper" style="height: auto;">
                                                 <table role="grid" class="gridjs-table" style="height: auto;">
                                                    <thead class="gridjs-thead">
                                                       <tr class="" >
                                                          <th data-column-id="#"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 40px;">
                                                             <div class="gridjs-th-content">#</div>
                                                          </th>
                                                          <th data-column-id="event"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 360px;">
                                                             <div class="gridjs-th-content">Location</div>
                                                          </th>
                                                          <th data-column-id=""
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 200px;">
                                                             <div class="gridjs-th-content">Added by</div>
                                                          </th>
                                                          <th data-column-id="guests"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width:120px;">
                                                             <div class="gridjs-th-content">Max Guests</div>
                                                          </th>
                                                          <th data-column-id="price"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 101px;">
                                                             <div class="gridjs-th-content">Price</div>
                                                          </th>
                                                          <th data-column-id="location"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width:184px;">
                                                             <div class="gridjs-th-content">Location</div>
                                                          </th>
                                                          <th data-column-id="rating"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 105px;">
                                                             <div class="gridjs-th-content">Rating</div>
                                                          </th>
                                                          <th data-column-id="action"
                                                             class="gridjs-th gridjs-th-sort text-muted"
                                                             tabindex="0" style="width: 80px;">
                                                             <div class="gridjs-th-content">Action</div>
                                                          </th>
                                                       </tr>
                                                    </thead>
                                                    <tbody class="gridjs-tbody">
                                                    </tbody>
                                                 </table>
                                                 <div class="py-4 text-center no-result-message" id="no-result-message" style="display: none;">
                                                    <div style="width:1185px;"></div>
                                                    <h5 class="mt-4">Sorry! No Result Found</h5>
                                                 </div>
                                              </div>
                                              <div class="gridjs-footer" id="footer-3">
                                                <div class="gridjs-pagination">
                                                    <div role="status" aria-live="polite" class="gridjs-summary"
                                                       title="Page 1 of 1">
                                                    </div>
                                                    <div class="gridjs-pages">
                                                    </div>
                                                 </div>
                                              </div>
                                              <div id="gridjs-temp" class="gridjs-temp"></div>
                                           </div>
                                        </div>
                                     </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <div class="modal fade flip" id="DeleteLocationModal" tabindex="-1" aria-hidden="true">
                              <form method="POST" action="">
                                 {% csrf_token %}
                                 <input type="hidden" name="location_id" id="item_id">
                                
                                   <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-body p-5 text-center">
                                            <lord-icon src="https://cdn.lordicon.com/gsqxdxog.json" trigger="loop"
                                                colors="primary:#405189,secondary:#f06548"
                                                style="width:90px;height:90px"></lord-icon>
                                            <div class="mt-4 text-center">
                                                <h4>You are about to delete a location.</h4>
                                                <p class="text-muted fs-15 mb-4">Deleting a location will remove all of
                                                    it's information from your database.</p>
                                                <div class="hstack gap-2 justify-content-center remove">
                                                    <button
                                                        class="btn btn-link link-success fw-medium text-decoration-none"
                                                        id="deleteRecord-close" data-bs-dismiss="modal"><i
                                                            class="ri-close-line me-1 align-middle"></i> Close</button>
                                                    <button type="submit" class="btn btn-danger" id="delete-record">Yes, Delete
                                                        It</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                              </form>
                            </div>
</div>
       
<style>
    .bi-three-dots {
    z-index: auto !important;
}
.dropdown .btn {
    position: relative;
    z-index: 2;
}
.dropdown-menu {
    z-index: 3050 !important;
}

    .noUi-base:first-of-type{
        display: none !important;
    }
</style>
<script>
       $('#DeleteLocationModal').on('show.bs.modal', function (event) {
    const button = event.relatedTarget; 
    const locationId = button.dataset.id; 
    console.log("Id: ", locationId)
    document.querySelector('#DeleteLocationModal #item_id').value = locationId;
});
    window.onload = function () {
    let rowsPerPage = 5;
    let currentPage = 1;
    let selectedType = "all";
    let eventsCount = 0;
    let totalPages = 0;

    var slider = document.getElementById('location-price-range');
    document.getElementById("searchOrganizersList").addEventListener("keyup", function () {
    let filter = this.value.toLowerCase();
    let checkboxes = document.querySelectorAll(".org-filter-check .form-check");

    checkboxes.forEach(check => {
        let labelElement = check.querySelector("label");
        if (!labelElement) return;

        let hasNestedElements = labelElement.querySelector("span, i, svg");

        if (hasNestedElements) return;

        let labelText = labelElement.innerText.trim().toLowerCase();

        if (labelText.includes(filter)) {
            check.style.display = "";
        } else {
            check.style.display = "none";
        }
    });
});


    noUiSlider.create(slider, {
        start: [0, 3500],
        connect: true,
        range: {
            'min': 0,
            'max': 3500
        },
        step: 1,
        format: {
            to: value => parseFloat(value).toFixed(0),
            from: value => value
        }
    });

    slider.noUiSlider.on('update', function(values, handle) {
        document.getElementById(handle === 0 ? 'minCost' : 'maxCost').value = values[handle];
        currentPage = 1;
        updatePagination();
    });

    document.getElementById('minCost').addEventListener('input', function() {
        slider.noUiSlider.set([this.value, null]);
        currentPage = 1;
        updatePagination();
    });

    document.getElementById('maxCost').addEventListener('input', function() {
        slider.noUiSlider.set([null, this.value]);
        currentPage = 1;
        updatePagination();
    });

    function setActiveTab() {
        let activeTab = document.querySelector(".tab-pane-active.show");
        if (!activeTab) {
            let firstTab = document.querySelector(".tab-pane");
            if (firstTab) {
                firstTab.classList.add("tab-pane-active", "show");
            }
        }
    }

    function getActiveRows() {
        let activeTab = document.querySelector(".tab-pane-active.show");
        return activeTab ? Array.from(activeTab.querySelectorAll(".gridjs-tr")) : [];
    }

    function getFilteredRows() {
        let rows = getActiveRows();
        let searchFilter = document.getElementById("searchlocationList").value.toLowerCase();
        let minPrice = parseFloat(document.getElementById('minCost').value || 0);
        let maxPrice = parseFloat(document.getElementById('maxCost').value || 3500);
        let checkedOrganizers = Array.from(document.querySelectorAll('.org-filter-check .form-check-input:checked'))
        .map(checkbox => checkbox.parentElement.querySelector("label").textContent.trim().toLowerCase());
        let checkedRatings = Array.from(document.querySelectorAll('.star-filter-check .form-check-input:checked'))
    .map(checkbox => {
        let label = checkbox.parentElement.querySelector("label").textContent.trim();
        let rating = label.match(/\d+/)?.[0];
        return rating ? parseInt(rating) : null;
    })
    .filter(rating => rating !== null);

console.log(checkedRatings); 
        return rows.filter(row => {
            let eventTypes = row.dataset.types ? row.dataset.types.toLowerCase().split(",") : [];
            let priceCell = row.querySelector('.gridjs-td[data-column-id="price"]');
            let price = priceCell ? parseFloat(priceCell.innerText.replace('$', '').trim()) : 0;
            let locationName = row.querySelector("td[data-column-id='location']").textContent.toLowerCase();
            let organizer = row.querySelector("td[data-column-id='organized_by']").textContent.trim().toLowerCase();
            let starText = Array.from(row.querySelector("td[data-column-id='rating'] .badge")?.childNodes || [])
    .filter(node => node.nodeType === 3)
    .map(node => node.textContent.trim())
    .join("");
    let star = starText ? parseFloat(starText) : null;
    let starMatch = (star !== null && checkedRatings.includes(Math.floor(star)));
            let organizerMatch = checkedOrganizers.length > 0 && checkedOrganizers.includes(organizer);
            return (eventTypes.includes(selectedType) || selectedType === "all") && 
                   price >= minPrice && price <= maxPrice &&
                   locationName.includes(searchFilter) &&
                   organizerMatch && starMatch;
        });
    }

    function updatePagination() {
        let filteredRows = getFilteredRows();
        eventsCount = filteredRows.length;
        totalPages = Math.ceil(eventsCount / rowsPerPage);

        let activeTab = document.querySelector(".tab-pane-active.show");
        if (!activeTab) return;

        let paginationContainer = activeTab.querySelector(".gridjs-pages");
        if (paginationContainer) {
            paginationContainer.innerHTML = "";
            createPaginationButtons(filteredRows, paginationContainer);
        }

        let summary = activeTab.querySelector(".gridjs-summary");
        if (summary) {
            summary.innerHTML = `Showing <b>${Math.min((currentPage - 1) * rowsPerPage + 1, eventsCount)}</b> to 
                <b>${Math.min(currentPage * rowsPerPage, eventsCount)}</b> of <b>${eventsCount}</b> results`;
        }

        let noResultMessage = activeTab.querySelector(".no-result-message");
        if (noResultMessage) {
            noResultMessage.style.display = filteredRows.length === 0 ? "block" : "none";
        }

        filterRows(filteredRows);
    }

    function createPaginationButtons(filteredRows, paginationContainer) {
        let prevButton = document.createElement("button");
        prevButton.textContent = "Previous";
        prevButton.disabled = currentPage === 1;
        prevButton.onclick = function () {
            if (currentPage > 1) {
                currentPage--;
                updatePagination();
            }
        };
        paginationContainer.appendChild(prevButton);

        for (let i = 1; i <= totalPages; i++) {
            let pageButton = document.createElement("button");
            pageButton.textContent = i;
            pageButton.onclick = function () {
                currentPage = i;
                updatePagination();
            };
            paginationContainer.appendChild(pageButton);
        }

        let nextButton = document.createElement("button");
        nextButton.textContent = "Next";
        nextButton.disabled = currentPage === totalPages;
        nextButton.onclick = function () {
            if (currentPage < totalPages) {
                currentPage++;
                updatePagination();
            }
        };
        paginationContainer.appendChild(nextButton);
    }

    function filterRows(filteredRows) {
        let startIndex = (currentPage - 1) * rowsPerPage;
        let endIndex = startIndex + rowsPerPage;

        let activeTab = document.querySelector(".tab-pane-active.show");
        if (!activeTab) return;

        let allRows = activeTab.querySelectorAll(".gridjs-tr");
        allRows.forEach(row => row.style.display = "none");

        filteredRows.slice(startIndex, endIndex).forEach(row => {
            row.style.display = "";
        });
    }
document.querySelectorAll(".org-filter-check .form-check-input").forEach(checkbox => {
    checkbox.addEventListener("change", function () {
        currentPage = 1;
        updatePagination();
    });
});
document.querySelectorAll(".star-filter-check .form-check-input").forEach(checkbox => {
    checkbox.addEventListener("change", function () {
        currentPage = 1;
        updatePagination();
    });
});
    let typeFilters = document.querySelectorAll(".filter-list .listname");
    typeFilters.forEach(filter => {
        filter.addEventListener("click", function (event) {
            event.preventDefault();
            selectedType = filter.innerText.trim().toLowerCase();
            currentPage = 1;
            updatePagination();
        });
    });

    let searchInput = document.getElementById("searchlocationList");
    searchInput.addEventListener("keyup", function () {
        currentPage = 1;
        updatePagination();
    });

    let tabLinks = document.querySelectorAll('.nav-link');
    tabLinks.forEach(tab => {
        tab.addEventListener('click', function () {
            let allTabs = document.querySelectorAll('.tab-pane');
            allTabs.forEach(t => t.classList.remove("tab-pane-active", "show"));
            let activeTab = document.getElementById(tab.getAttribute("href").replace("#", ""));
            activeTab.classList.add("tab-pane-active", "show");
            updatePagination();
        });
    });

    setActiveTab();
    updatePagination();
};

</script>


<style>
    .gridjs-pages button{
        padding:5px;
        margin:10px;
        border:none;
        background: white;
        font-weight: 600;
    }
   
</style>
{% endblock content %}
