{% extends 'main.html' %}
{% block navbar %}
{% endblock %}


{% block content %}
{% load static %}
<style>
  .glow-text {
  color: white;
  text-shadow: 
      0 0 5px #fff,
      0 0 10px #fff,
      0 0 20px #deb6b6,
      0 0 50px #b9e1db;
  font-weight: bold;
  text-align: center;
}
.event-card {
  width: 23%;
  margin: 0 10px;
  text-align: center;
}

.event-card img {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
}

.event-card h5 {
  margin-top: 10px;
  font-size: 18px;
}

.event-card p {
  color: #777;
}
.glowing-card {
    border: 2px solid yellow;
    box-shadow: 0 0 15px yellow;
    transition: box-shadow 0.1s ease-in-out;
}

.glowing-card:hover {
    box-shadow: 0 0 25px yellow, 0 0 50px gold;
}

</style>
<div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
data-sidebar-position="fixed" data-header-position="fixed">
  <!-- Sidebar Start -->
  {% include 'sidebar.html' %}
  <!--  Sidebar End -->
  <!--  Main wrapper -->
  <div class="body-wrapper">
    <!--  Header Start -->
    {% include 'header.html' %}
    <!--  Header End -->
    
    <div class="container-fluid">

      <div class="title">
          <h1 class="h1">
              Welcome to your account {{ request.user.username }} !
          </h1>
      </div>
      <hr>
      
      <div class="row mt-4">
        <div class="col-lg-9 border-end">
            <div class="row">
                  {% if next_confirmed_event is not none %}
                    <div class="col-lg-12">
                            <div class="alert alert-warning alert-dismissible fade show" role="alert">
                              <a href="{% url 'guest_event_view' next_confirmed_event.id %}#menuGrid" class="alert-link">Looks like you have an Upcoming event!</a>
                              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                              <div class="card glowing-card mb-3">
                                <div class="row g-0">
                                    <div class="col-md-4 h-100">
                                      <img src="{{ MEDIA_URL }}{{ next_confirmed_event.location.gallery }}" class="img-fluid rounded-start" style="object-fit: cover;" alt="...">
                                    </div>
                                  <div class="col-md-8 h-100">
                                    <div class="card-body">
                                      <a href="{% url 'guest_event_view' next_confirmed_event.id %}">
                                      <h5 class="card-title">{{ next_confirmed_event.event_name }}</h5>
                                      </a>
                                      <p class="card-text">{{ next_confirmed_event.event_description }}</p>
                                      <p class="card-text"><small class="text-body-secondary"> <i class="bi bi-calendar-event me-1"></i> Date: {{ next_confirmed_event.event_date }}</small></p>
                                      <p class="card-text"><small class="text-body-secondary"> <i class="bi bi-geo-alt me-1"></i> {{ next_confirmed_event.location.location }}</small></p>
                                      <div class="card-text d-flex justify-content-start">
                                        {% include 'timer.html' %}
                                      </div>
                                      <div class="d-flex flex-row m-0">
                                        {% if rsvp.status == "confirmed" %}
                                          <span class="badge bg-success">RSVP: Confirmed</span>
                                          <span class="badge bg-success">My menu</span>
                                        {% else %}
                                          <span class="badge bg-warning text-dark">RSVP: Pending</span>
                                        {% endif %}
                                        <a href="https://www.google.com/maps/search/?api=1&query={{ next_confirmed_event.location.location|urlencode }}" target="_blank"  class="btn btn-outline-secondary btn-sm">Map</a>
                                        <a href="{% url 'guest_event_view' next_confirmed_event.id %}#menuGrid" class="btn btn-outline-secondary btn-sm">My menu</a>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                    </div>
                  {% else %}
                    <div class="col-lg-8">
                      <div class="alert alert-success alert-dismissible fade show" role="alert">
                        You have no upcoming events at the moment.
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                      </div>
                    </div>
                  {% endif %}

                  
          
              {% if upcoming_events %}
                <div class="col-lg-12">
                  <div class="card card-hover">
                      <div class="card-body">
                          <h1 class="card-title d-flex align-items-center gap-2">
                              Checkout future events that you are invited to!
                          </h1>
                      </div>
                  </div>
                </div>
              {% else %}
              <p>No more other upcoming events for now!</p>
              {%endif%}

                {% if upcoming_events %}
                  {% for event in upcoming_events %}
                  <div class="col-lg-8">
                    <a href="{% url 'guest_event_view' event.id %}">
                      <div class="card mb-3">
                        <div class="row g-0">
                            <div class="col-md-4">
                              <img src="{{ MEDIA_URL }}{{ event.location.gallery }}" class="img-fluid rounded-start" style="object-fit: cover;">
                            </div>
                          <div class="col-md-8">
                            <div class="card-body">
                              <h5 class="card-title">{{ event.event_name }}</h5>
                              <p class="card-text">{{ event.event_description }}</p>
                              <p class="card-text"><small class="text-body-secondary">Date: {{ event.event_date }}</small></p>
                              <p class="card-text">
                                {% include 'timer.html' %}
                              </p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </a>  
                  </div> 
                  {% endfor %}
                {% endif %}

              </div>
        </div>
        
        <div class="col-lg-3">
          <div class="row">

             <div class="container h-100">
              <div class="row d-flex justify-content-center align-items-center h-100">
                <div class="col-md-12">

                  <div class="card" style="border-radius: 15px;">
                    <div class="card-body text-center">
                      <div class="mt-3 mb-4">
                        <img src="{{ MEDIA_URL }}{{ profile.photo }}"
                          class="rounded-circle img-fluid" style="width: 100px; height: 100px; object-fit: cover;" />
                      </div>
                      <h4 class="mb-2">{{profile.username}}</h4>
                      
                      <a href="{% url 'guest_profile' %}"  type="button" data-mdb-button-init data-mdb-ripple-init class="btn btn-primary btn-rounded">
                        Acces Profile
                      </a>
                      <div class="d-flex justify-content-between text-center mt-2 mb-2">
                        <div>
                          <p class="mb-2 h5">{{past_events_count}}</p>
                          <p class="text-muted mb-0">Events Attended</p>
                        </div>
                        <div class="px-3">
                          <p class="mb-2 h5">0</p>
                          <p class="text-muted mb-0">Events Canceled</p>
                        </div>
                        <div>
                          <p class="mb-2 h5">{% if upcoming_events_count == 0 %}{% if next_confirmed_event %}1{%else%}0{%endif%}{%else%}{{upcoming_events_count}}{%endif%}</p>
                          <p class="text-muted mb-0">Upcoming Events</p>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </div>

              <div class="col-lg-12">
                <div class="card">
                  <div class="card-body">
                    <h1 class="card-title d-flex align-items-center gap-2" data-bs-toggle="collapse" href="#collapseCompletedEvents" role="button" aria-expanded="true" aria-controls="collapseCompletedEvents">Completed events                      <span class="badge text-bg-primary">{{ past_events_count }}</span>
</h1>
                    <p>Share how you felt at the event with the other guests!</p>
                  </div>
                </div>
                <div class="collapse" id="collapseCompletedEvents">

                  {% if past_events %}
                  <link rel="stylesheet" href="{% static 'css/output.css' %}">
                    
                    <div class="table-responsive shadow-sm rounded-4 overflow-hidden">
                      <table class="table align-middle mb-0">
                        <thead class="table-light position-sticky top-0 z-index-1">
                          <tr class="text-uppercase small fw-semibold">
                            <th scope="col"><i class="bi bi-calendar-event"></i> Event</th>
                            <th scope="col"><i class="bi bi-clock"></i> Date</th>
                            <th scope="col"><i class="bi bi-info-circle"></i> Status</th>
                          </tr>
                        </thead>
                        <tbody class="table-group-divider">
                          {% for event in past_events %}
                          <tr class="table-row-hover">
                            <td class="fw-medium"><a href="{% url 'guest_event_view' event.id %}">{{ event.event_name }}</a></td>
                            <td>{{ event.event_date|date:"F j, Y" }}</td>
                            <td>
                              {% if event.status == "upcoming" %}
                                <span class="badge bg-warning text-dark">Upcoming</span>
                              {% elif ev.status == "ongoing" %}
                                <span class="badge bg-success">Ongoing</span>
                              {% else %}
                                <span class="badge bg-secondary">Completed</span>
                              {% endif %}
                            </td>
                          </tr>
                          {% empty %}
                            <tr><td colspan="3" class="text-center py-4 text-muted">No events found</td></tr>
                        </tbody>
                      </table>
                    </div>
                    
                    <style>
                    .table-row-hover:hover { background-color:#f8f9fa; transition:.2s; }
                    .table-responsive { background:#fff; }
                    .table-light { background:linear-gradient(90deg,#f0f0f0 0%,#fafafa 100%); }
                    .table-group-divider>tr:not(:last-child){ border-bottom:1px solid rgba(0,0,0,.06); }
                    </style>
                    {% endfor %}
                  {% endif %}
              </div>
            </div>  
          </div>
        </div>
      </div>  
  </div>
</div>
{% endblock %}